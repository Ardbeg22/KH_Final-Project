<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="communityMapper">

<!-- COMMUNITY 테이블로부터 조회된 내용을 community 타입으로 가공해주는 ResultMap -->
	<resultMap id="communityResultSet" type="community">
		<result column="COM_NO" property="comNo" />
		<result column="COM_TITLE" property="comTitle" />
		<result column="COM_CONTENT" property="comContent" />
		<result column="COM_REGISTER_DATE" property="comRegisterDate" />
		<result column="COM_HIT" property="comHit" />
		<result column="COM_STATUS" property="comStatus" />
		<result column="USER_NICKNAME" property="userNickname" />
		<result column="USER_NO" property="userNo" />
	</resultMap>
	
	<!-- 커뮤니티 게시글 수 조회 쿼리문 -->
	<select id="selectCommunityListCount" resultType="_int">
		SELECT COUNT(*)
		FROM COMMUNITY
		WHERE COM_STATUS = 'Y'
	</select>
	
	<!-- 관리자 / 회원 커뮤니티 게시글 리스트 조회 쿼리문 -->
	<select id="selectCommunityList" resultMap="communityResultSet">
		SELECT COM_NO
				     , COM_TITLE
				     , TO_CHAR(COM_REGISTER_DATE, 'YYYY-MM-DD') AS "COM_REGISTER_DATE"
				     , USER_NICKNAME
				     , COM_HIT
		FROM COMMUNITY C
		LEFT JOIN MEMBER MB USING(USER_NO)
		WHERE C.COM_STATUS = 'Y'
		ORDER BY COM_NO DESC;
	</select>
	
	<!-- 커뮤니티 게시글 등록 쿼리문 -->
	<insert id="insertCommunity" parameterType="community">
		INSERT INTO COMMUNITY (COM_NO
						   , COM_TITLE
					       , USER_NICKNAME)
				   VALUES (SEQ_COM_NO.NEXTVAL
				   		 , #{comTitle}
				   		 , #{userNickname})
	</insert>
	
	<!-- 커뮤니티 게시글 조회수 증가 쿼리문(관리자 + 회원) -->
	<update id="communityIncreaseCount" parameterType="_int">
		UPDATE COMMUNITY
		   SET COM_HIT = COM_HIT + 1
		 WHERE COM_NO = #{comNo}
		   AND COM_STATUS = 'Y'
	</update>
	
	<!-- 커뮤니티 게시글 상세조회 쿼리문(관리자 + 회원) -->
	<select id="selectCommunity" parameterType="_int" resultMap="communityResultSet">
		SELECT COM_NO
				    , COM_TITLE
					 , COM_CONTENT
					 , TO_CHAR(NOTICE_REGISTER_DATE, 'YYYY-MM-DD') AS "NOTICE_REGISTER_DATE"
					 , COM_HIT
		FROM COMMUNITY
		WHERE COM_NO = #{comNo}
	</select>

</mapper>